{% trans_default_domain 'PubLeashBundle' %}
{% extends '@PubLeash/layout.html.twig' %}
{% import '@PubLeash/layout.html.twig' as layout %}

{% block title %}
    - {{ publication.title }}
{% endblock %}

{% block side_nav %}
    <nav class="navbar navbar-inverse navbar-fixed-top" id="sidebar-wrapper" role="navigation">
        <ul class="nav sidebar-nav">
            {#<li>#}
                {#<a href="#"><i class="glyphicon glyphicon-home"></i> </a>#}
            {#</li>#}
            {% if publication_service.allowedEdit(publication) %}
                <li data-toggle="tooltip" data-placement="right" title="Edit publication">
                    <a href="{{ path('publeash_publication_editpublication', {publicationId: publication.id, name: publication.prettyUrlTitle}) }}">
                        <i class="glyphicon glyphicon-edit"></i>
                    </a>
                </li>
            {% endif %}
            {% if publication_service.allowedEdit(publication) %}
                <li data-toggle="tooltip" data-placement="right" title="Add publication">
                    <a href="{{ path('publeash_publication_addchapter', {publicationId: publication.id}) }}">
                        <i class="glyphicon glyphicon-plus"></i>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
    <script type="application/javascript">
        $(document).ready(function () {
            $('#wrapper').css('padding-left', '55px');
            $('#sidebar-wrapper').css('width', '55px');
        });
    </script>
{% endblock %}

{% block body %}
    <!-- /#sidebar-wrapper -->
    <div class="row publication-show">
        <div class="container-fluid">
            {% if not publication_service.allowedShow(publication) %}
                <div class="page-header">
                    <h1>{{ 'publication.show.noauthor'|trans }}</h1>
                </div>
            {% else %}
                <div class="page-header">
                    <h1>{{ publication.title }}
                        {{ layout.stars(publication.rank) }}
                    </h1>

                </div>
                <div class="author row">
            <span class="text-left col-md-6">
            {{ 'publication.author'|trans }}:
                {% for author in publication.authors %}
                    {{ author.username }} {{ (loop.last == false) ? ',' : '' }}
                {% endfor %}
            </span>
            <span class="text-right col-md-6">
                {{ 'publication.date_create'|trans }}: {{ publication.dateCreate }}
                {{ 'publication.date_update'|trans }}: {{ publication.dateUpdate }}
            </span>
                </div>
                <div class="panel panel-default">
                    <div class="panel-body">
                        {{ publication.description }}
                    </div>
                </div>
                <div class="page-header">
                    <h3>{{ 'publication.chapters.available'|trans }}<span>
                        </span>
                    </h3>
                </div>
                <div class="panel panel-default">
                    <div class="panel-body">
                    {% set chapters = publication.chapters %}
                    {% for chapter in chapters %}
                        <div class="bs-callout bs-callout-info" onclick="location.href='{{ path('publeash_publication_showpublicationchapter', { "publicationId": publication.id, "chapterId": chapter.id }) }}'">
                            <div class="page-header">
                                <h3>{{ chapter.title }}
                                    {{ layout.stars(chapter.rank) }}
                            </div>
                            <div class="row author">
                                <span class="text-right col-md-6 col-md-offset-6">
                                    {{ 'publication.date_create'|trans }}: {{ chapter.dateCreate }}
                                    {{ 'publication.date_update'|trans }}: {{ chapter.dateUpdate }}
                                </span>
                            </div>

                            {{ chapter.preview | raw }}
                        </div>
                    {% endfor %}
                    </div>
                </div>
                <div class="page-header">
                    <h3>{{ 'publication.reviews'|trans }}</h3>
                </div>
                {{ layout.reviews(publication.reviews) }}
            {% endif %}
        </div>
    </div>
{% endblock %}